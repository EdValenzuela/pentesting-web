#!/bin/bash

function info {
    IFS=":"
    user=($1);
    echo "** INFORMACIÓN PARA ${user[0]} **"
    echo "El espacio ocupado por su directorio personal ${user[5]} es: " $(du -sh ${user[5]} | cut -fl)
    if $(who | egrep "^${user[0]}\b" &> /dev/null); then
        echo "Actualmente está en el sistema"
    else 
        acceso=$(grep opened.*${user[0]} /var/log/auth.log | tail -n1 | tr -s " " | cut -d" " -fl-3)
        if [ -z $acceso ]; then
            echo "Nunca ha estado en el sistema"
        else
            echo "Y su último acceso fue $acceso"
        fi
    fi
    IFS=" "
}

read -p "Introduzca el nombre del grupo: " grupo
gid=$(egrep ^$grupo: /etc/group | cut -d":" -f3)
usuarios=$(egrep "^\w+:x:\w+:$gid:" /etc/passwd)

if [ -z "$usuarios" ]; then
    echo "No se han encontrado usuarios"
    exit 1
fi 

for u in $usuarios; do
    info $u 
done




